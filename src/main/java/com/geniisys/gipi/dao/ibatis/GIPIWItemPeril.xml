<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap>

	<cacheModel id="oneDayClient" type="MEMORY">
		<flushInterval hours="24" />
		<property name="reference-type" value="WEAK" />
	</cacheModel>
	
	<typeAlias alias="GIPIWItemPerilClass" type="com.geniisys.gipi.entity.GIPIWItemPeril"/>
	
	<resultMap class="GIPIWItemPerilClass" id="GIPIWItemPerilMap">
		<result column="PAR_ID" 		property="parId"/>
		<result column="ITEM_NO" 		property="itemNo"/>
		<result column="LINE_CD" 		property="lineCd"/>
		<result column="PERIL_CD" 		property="perilCd"/>
		<result column="PERIL_NAME" 	property="perilName"/>
		<result column="PERIL_TYPE" 	property="perilType"/>
		<result column="TARF_CD" 		property="tarfCd"/>
		<result column="PREM_RT" 		property="premRt"/>
		<result column="TSI_AMT" 		property="tsiAmt"/>
		<result column="PREM_AMT" 		property="premAmt"/>
		<result column="ANN_TSI_AMT" 	property="annTsiAmt"/>
		<result column="ANN_PREM_AMT" 	property="annPremAmt"/>
		<result column="COMP_REM" 		property="compRem"/>
		<result column="PRT_FLAG" 		property="prtFlag"/>
		<result column="RI_COMM_RATE" 	property="riCommRate"/>
		<result column="RI_COMM_AMT" 	property="riCommAmt"/>
		<result column="SURCHARGE_SW" 	property="surchargeSw"/>
		<result column="NO_OF_DAYS" 	property="noOfDays"/>
		<result column="BASE_AMT" 		property="baseAmt"/>
		<result column="AGGREGATE_SW" 	property="aggregateSw"/>
		<result column="DISCOUNT_SW" 	property="discountSw"/>
		<result column="BASC_PERL_CD" 	property="bascPerlCd"/>
		<result column="REC_FLAG" 		property="recFlag"/>
	</resultMap>
	
	<resultMap class="GIPIWItemPerilClass" id="GIPIWItemPerilAllColsResultMap">
		<result column="PAR_ID"			property="parId" />
		<result column="ITEM_NO"		property="itemNo" />
		<result column="LINE_CD"		property="lineCd" />
		<result column="PERIL_CD"		property="perilCd" />
		<result column="TARF_CD"		property="tarfCd" />
		<result column="PREM_RT"		property="premRt" />
		<result column="TSI_AMT"		property="tsiAmt" />
		<result column="PREM_AMT"		property="premAmt" />
		<result column="ANN_TSI_AMT"	property="annTsiAmt" />
		<result column="ANN_PREM_AMT"	property="annPremAmt" />
		<result column="REC_FLAG"		property="recFlag" />
		<result column="COMP_REM"		property="compRem" />
		<result column="DISCOUNT_SW"	property="discountSw" />
		<result column="PRT_FLAG"		property="prtFlag" />
		<result column="RI_COMM_RATE"	property="riCommRate" />
		<result column="RI_COMM_AMT"	property="riCommAmt" />
		<result column="AS_CHARGE_SW"	property="asChargeSw" />
		<result column="SURCHARGE_SW"	property="surchargeSw" />
		<result column="NO_OF_DAYS"		property="noOfDays" />
		<result column="BASE_AMT"		property="baseAmt" />
		<result column="AGGREGATE_SW"	property="aggregateSw" />
	</resultMap>
	
	<resultMap class="GIPIWItemPerilClass" id="PerilDetailsMap">	
		<result column="PREM_RT" 		property="premRt"/>
		<result column="TSI_AMT" 		property="tsiAmt"/>
		<result column="PREM_AMT" 		property="premAmt"/>
		<result column="ANN_TSI_AMT" 	property="annTsiAmt"/>
		<result column="ANN_PREM_AMT" 	property="annPremAmt"/>
		<result column="RI_COMM_RATE" 	property="riCommRate"/>
		<result column="RI_COMM_AMT" 	property="riCommAmt"/>		
	</resultMap>
	
	<resultMap class="GIPIWItemPerilClass" id="EndtPerilMap">
		<result column="PAR_ID" 		property="parId"/>
		<result column="ITEM_NO" 		property="itemNo"/>
		<result column="LINE_CD" 		property="lineCd"/>
		<result column="PERIL_CD" 		property="perilCd"/>
		<result column="PERIL_NAME" 	property="perilName"/>	
		<result column="PREM_RT" 		property="premRt"/>
		<result column="TSI_AMT" 		property="tsiAmt"/>
		<result column="PREM_AMT" 		property="premAmt"/>
		<result column="ANN_TSI_AMT" 	property="annTsiAmt"/>
		<result column="ANN_PREM_AMT" 	property="annPremAmt"/>
		<result column="COMP_REM" 		property="compRem"/>
		<result column="REC_FLAG" 		property="recFlag"/>
		<result column="RI_COMM_RATE" 	property="riCommRate"/>
		<result column="RI_COMM_AMT" 	property="riCommAmt"/>
		<result column="TARF_CD" 	    property="tarfCd"/>
		<result column="NO_OF_DAYS" 	property="noOfDays"/>
		<result column="BASE_AMT" 		property="baseAmt"/>
		<result column="DISC_SUM" 		property="discSum"/>
		<result column="PERIL_TYPE" 	property="perilType"/>
		<result column="BASC_PERL_CD" 	property="bascPerlCd"/>			
	</resultMap>	

	<resultMap class="java.util.HashMap" id="GIPIS097GIPIWItmperlResultMap">
		<result column="PAR_ID" 		property="parId"/>
		<result column="ITEM_NO" 		property="itemNo"/>
		<result column="LINE_CD" 		property="lineCd"/>
		<result column="PERIL_CD" 		property="perilCd"/>
		<result column="PERIL_NAME" 	property="perilName"/>	
		<result column="PREM_RT" 		property="premRt"/>
		<result column="TSI_AMT" 		property="tsiAmt"/>
		<result column="PREM_AMT" 		property="premAmt"/>
		<result column="ANN_TSI_AMT" 	property="annTsiAmt"/>
		<result column="ANN_PREM_AMT" 	property="annPremAmt"/>
		<result column="COMP_REM" 		property="compRem"/>
		<result column="REC_FLAG" 		property="recFlag"/>
		<result column="RI_COMM_RATE" 	property="riCommRate"/>
		<result column="RI_COMM_AMT" 	property="riCommAmt"/>
		<result column="TARF_CD" 	    property="tarfCd"/>
		<result column="NO_OF_DAYS" 	property="noOfDays"/>
		<result column="BASE_AMT" 		property="baseAmt"/>
		<result column="DISC_SUM" 		property="discSum"/>
		<result column="PERIL_TYPE" 	property="perilType"/>
		<result column="BASC_PERL_CD" 	property="bascPerlCd"/>
		<result column="ENDT_ANN_TSI_AMT" 	property="endtAnnTsiAmt"/>
		<result column="ENDT_ANN_PREM_AMT" 	property="endtAnnPremAmt"/>
		<result column="BASE_ANN_PREM_AMT" 	property="baseAnnPremAmt"/>				
	</resultMap>	
	
	<resultMap class="GIPIWItemPerilClass" id="itemAndPerilDetailsMap">
		<result column="PERIL_PREM_AMT" 	property="perilPremAmt"/>
		<result column="PERIL_ANN_PREM_AMT" property="perilAnnPremAmt"/>
		<result column="PERIL_ANN_TSI_AMT" 	property="perilAnnTsiAmt"/>
		<result column="ITEM_PREM_AMT" 		property="itemPremAmt"/>
		<result column="ITEM_ANN_PREM_AMT" 	property="itemAnnPremAmt"/>
		<result column="ITEM_TSI_AMT" 		property="itemTsiAmt"/>
		<result column="ITEM_ANN_TSI_AMT" 	property="itemAnnTsiAmt"/>
		<result column="PERIL_TSI_AMT" 		property="perilTsiAmt"/>
	</resultMap>
	
	<parameterMap class="map" id="deleteDiscountsMap">
		<parameter property="parId" 	jdbcType="INT"	javaType="java.lang.Integer"		mode="IN"/>
		<parameter property="itemNo" 	jdbcType="INT"	javaType="java.lang.Integer"		mode="IN"/>
		<parameter property="premAmt" 	jdbcType="VARCHAR"	javaType="java.lang.String"		mode="OUT"/>
		<parameter property="annPremAmt" jdbcType="VARCHAR"	javaType="java.lang.String"		mode="OUT"/>
	</parameterMap>
	
	<parameterMap class="map" id="isExistMapWItmperl">
	    <parameter property="parId"			    jdbcType="VARCHAR" 	javaType="java.lang.String"  mode="IN"/>
	    <parameter property="exist"			    jdbcType="VARCHAR" 	javaType="java.lang.String"  mode="OUT"/>
	</parameterMap>
	
	<parameterMap class="map" id="checkEndtPerilMap">
		<parameter property="parId" 		 	jdbcType="INT"		javaType="java.lang.Integer"	mode="IN"/>
		<parameter property="itemNo" 		 	jdbcType="INT"		javaType="java.lang.Integer"	mode="IN"/>
		<parameter property="lineCd" 		 	jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN"/>
		<parameter property="sublineCd"		 	jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN"/>
		<parameter property="perilCd" 		 	jdbcType="INT"		javaType="java.lang.Integer"	mode="IN"/>	
		<parameter property="message" 		 	jdbcType="VARCHAR"	javaType="java.lang.String"		mode="INOUT"/>
		<parameter property="validationFlag" 	jdbcType="VARCHAR"	javaType="java.lang.String"		mode="INOUT"/>		
	</parameterMap>
	
	<parameterMap class="map" id="endtPerilAmountsMap">
		<parameter property="parId" 		 		jdbcType="INT"		javaType="java.lang.Integer"	mode="IN"/>
		<parameter property="itemNo" 		 		jdbcType="INT"		javaType="java.lang.Integer"	mode="IN"/>
		<parameter property="perilCd" 		 		jdbcType="INT"		javaType="java.lang.Integer"	mode="IN"/>
		<parameter property="premiumRate"	 		jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>
		<parameter property="tsiAmount" 			jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>
		<parameter property="annTsiAmount" 			jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>
		<parameter property="premiumAmount"			jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>			
		<parameter property="annPremiumAmount" 		jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>		
		<parameter property="recFlag" 		 		jdbcType="VARCHAR"	javaType="java.lang.String"		mode="INOUT"/>
		<parameter property="itemTsiAmount" 		jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>
		<parameter property="itemAnnTsiAmount" 		jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>
		<parameter property="itemPremiumAmount"		jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>			
		<parameter property="itemAnnPremiumAmount" 	jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>
		<parameter property="planSw" 		 		jdbcType="VARCHAR"	javaType="java.lang.String"		mode="INOUT"/>			
		<parameter property="message" 		 		jdbcType="VARCHAR"	javaType="java.lang.String"		mode="INOUT"/>	
	</parameterMap>
	
	<parameterMap class="map" id="validatePremiumAmountMap">
		<parameter property="parId" 		 		jdbcType="INTEGER"	javaType="java.lang.Integer"	mode="IN"/>
		<parameter property="lineCd" 		 	    jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN"/>
		<parameter property="vIndicator" 		 	jdbcType="INTEGER"	javaType="java.lang.Integer"	mode="OUT"/>
		<parameter property="minPremAmt"			jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="OUT"/>			
		<parameter property="totalPremiumAmt" 		jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="OUT"/>		
	</parameterMap>	
	
	<parameterMap class="map" id="endtTariffMap">
		<parameter property="parId" 		 		jdbcType="INT"		javaType="java.lang.Integer"	mode="IN"/>
		<parameter property="itemNo" 		 		jdbcType="INT"		javaType="java.lang.Integer"	mode="IN"/>
		<parameter property="perilCd" 		 		jdbcType="INT"		javaType="java.lang.Integer"	mode="IN"/>
		<parameter property="tsiAmount" 			jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>
		<parameter property="premiumAmount"			jdbcType="FLOAT"	javaType="java.math.BigDecimal"	mode="INOUT"/>				
	</parameterMap>				
	
	<parameterMap class="map" id="computeTsiMap">
		<parameter property="parId" 		 		jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="perilCd" 		 		jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="perilType" 		 	jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN"/>
		<parameter property="changedTag" 		 	jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN"/>
		<parameter property="tsiAmt"	 			jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="premRt"	 			jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>		
		<parameter property="annTsiAmt"	 			jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="annPremAmt"	 		jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemTsiAmt"			jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemPremAmt"			jdbcType="INTEGER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemAnnTsiAmt"			jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>	 
		<parameter property="itemAnnPremAmt"		jdbcType="INTEGER"	javaType="java.lang.String"	mode="IN"/>		
		<parameter property="noOfDays" 		 		jdbcType="INTEGER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemToDate"			jdbcType="DATE"		javaType="java.util.Date"		mode="IN"/>
		<parameter property="itemFromDate"			jdbcType="DATE"		javaType="java.util.Date"		mode="IN"/>
		<parameter property="itemCompSw"			jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN"/>
		<parameter property="planSw"				jdbcType="VARCHAR"	javaType="java.lang.String"		mode="IN"/>		
		<parameter property="outTsiAmt" 		 	jdbcType="NUMERIC"	javaType="java.math.BigDecimal"		mode="OUT"/>
		<parameter property="outPremAmt" 		 	jdbcType="NUMERIC"	javaType="java.math.BigDecimal"	mode="OUT"/>
		<parameter property="outAnnTsiAmt" 		 	jdbcType="NUMERIC"	javaType="java.math.BigDecimal"		mode="OUT"/>
		<parameter property="outAnnPremAmt" 		jdbcType="NUMERIC"	javaType="java.math.BigDecimal"	mode="OUT"/>
		<parameter property="baseAnnPremAmt" 	jdbcType="NUMERIC"	javaType="java.math.BigDecimal"	mode="OUT"/>		
	</parameterMap>
	
	<parameterMap class="map" id="negateDeleteItemEndtParameterMap">
		<parameter property="parId"			jdbcType="INTEGER"		javaType="java.lang.Integer"	mode="IN" />
		<parameter property="itemNo"		jdbcType="INTEGER"		javaType="java.lang.Integer"	mode="IN" />
		<parameter property="premAmt"		jdbcType="NUMERIC"		javaType="java.math.BigDecimal"	mode="OUT" />
		<parameter property="tsiAmt"		jdbcType="NUMERIC"		javaType="java.math.BigDecimal"	mode="OUT" />
		<parameter property="annPremAmt"	jdbcType="NUMERIC"		javaType="java.math.BigDecimal"	mode="OUT" />
		<parameter property="annTsiAmt"		jdbcType="NUMERIC"		javaType="java.math.BigDecimal"	mode="OUT" />
		<parameter property="gipiWItmPerl"	jdbcType="ORACLECURSOR"	javaType="java.sql.ResultSet"	resultMap="GIPIWItemPerilAllColsResultMap" mode="OUT" />
	</parameterMap>
	
	<resultMap class="GIPIWItemPerilClass" id="ItemPerilTableGridResultMap" extends="BaseEntity.TableGridResultMap">
		<result column="PAR_ID" 		property="parId"/>
		<result column="ITEM_NO" 		property="itemNo"/>
		<result column="LINE_CD" 		property="lineCd"/>
		<result column="PERIL_CD" 		property="perilCd"/>
		<result column="PERIL_NAME" 	property="perilName"/>
		<result column="PERIL_TYPE" 	property="perilType"/>
		<result column="TARF_CD" 		property="tarfCd"/>
		<result column="PREM_RT" 		property="premRt"/>
		<result column="TSI_AMT" 		property="tsiAmt"/>
		<result column="PREM_AMT" 		property="premAmt"/>
		<result column="ANN_TSI_AMT" 	property="annTsiAmt"/>
		<result column="ANN_PREM_AMT" 	property="annPremAmt"/>
		<result column="COMP_REM" 		property="compRem"/>
		<result column="PRT_FLAG" 		property="prtFlag"/>
		<result column="RI_COMM_RATE" 	property="riCommRate"/>
		<result column="RI_COMM_AMT" 	property="riCommAmt"/>
		<result column="SURCHARGE_SW" 	property="surchargeSw"/>
		<result column="NO_OF_DAYS" 	property="noOfDays"/>
		<result column="BASE_AMT" 		property="baseAmt"/>
		<result column="AGGREGATE_SW" 	property="aggregateSw"/>
		<result column="DISCOUNT_SW" 	property="discountSw"/>
		<result column="BASC_PERL_CD" 	property="bascPerlCd"/>
		<result column="REC_FLAG" 		property="recFlag"/>
	</resultMap>
	
	<resultMap class="GIPIWItemPerilClass" id="EndtItemPerilTableGridResultMap" extends="BaseEntity.TableGridResultMap">
		<result column="PAR_ID" 		property="parId"/>
		<result column="ITEM_NO" 		property="itemNo"/>
		<result column="LINE_CD" 		property="lineCd"/>
		<result column="PERIL_CD" 		property="perilCd"/>
		<result column="PERIL_NAME" 	property="perilName"/>
		<result column="PERIL_TYPE" 	property="perilType"/>
		<result column="TARF_CD" 		property="tarfCd"/>
		<result column="PREM_RT" 		property="premRt"/>
		<result column="TSI_AMT" 		property="tsiAmt"/>
		<result column="PREM_AMT" 		property="premAmt"/>
		<result column="ANN_TSI_AMT" 	property="annTsiAmt"/>
		<result column="ANN_PREM_AMT" 	property="annPremAmt"/>
		<result column="COMP_REM" 		property="compRem"/>
		<result column="PRT_FLAG" 		property="prtFlag"/>
		<result column="RI_COMM_RATE" 	property="riCommRate"/>
		<result column="RI_COMM_AMT" 	property="riCommAmt"/>
		<result column="SURCHARGE_SW" 	property="surchargeSw"/>
		<result column="NO_OF_DAYS" 	property="noOfDays"/>
		<result column="BASE_AMT" 		property="baseAmt"/>
		<result column="AGGREGATE_SW" 	property="aggregateSw"/>
		<result column="DISCOUNT_SW" 	property="discountSw"/>
		<result column="BASC_PERL_CD" 	property="bascPerlCd"/>
		<result column="REC_FLAG" 		property="recFlag"/>
	</resultMap>
	
	<select id="getPostTextTsiAmtDetails" resultMap="itemAndPerilDetailsMap">
		SELECT * FROM TABLE(GIPI_WITMPERL_PKG.get_post_tsi_details(
		 						#parId#,
								#itemNo#,
								#perilCd#,
								#premRt#,
								#tsiAmt#,
								#premAmt#,
								#annTsiAmt#,
								#annPremAmt#,
								#itemTsiAmt#,
								#itemPremAmt#,
								#itemAnnTsiAmt#,   
								#itemAnnPremAmt#))
	</select>
	
	<select id="getPerilDetails" resultMap="PerilDetailsMap" parameterClass="java.util.HashMap">
		SELECT * FROM TABLE(GIPI_WITMPERL_PKG.get_peril_details(#parId#,
	   	  		  			 #itemNo#,
							 #perilCd#,
							 #premAmt#,
							 #compRem#))
	</select>
	
	<select id="getItemPeril" resultMap="GIPIWItemPerilMap">
		select * from table(Gipi_Witmperl_Pkg.get_gipi_witmperl(#parId#, null))
	</select>
	
	<select id="getGIPIWItemPeril" parameterClass="java.util.HashMap" resultMap="GIPIWItemPerilMap">
		select * from table(Gipi_Witmperl_Pkg.get_gipi_witmperl(#parId#, #itemNo#))
	</select>
	
	<select id="getItemPerilForPackPolicyItems" resultMap="GIPIWItemPerilMap">
		SELECT * FROM TABLE(gipi_witmperl_pkg.get_gipi_witmperl_pack_pol(#parId#, #itemNo#))
	</select>
	
	<select id="isExistWItmperl2" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		SELECT GIPI_WITMPERL_PKG.is_exist_gipi_witmperl(#parId#, #itemNo#) FROM dual
	</select>
	
	<select id="checkIfParItemHasPeril" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		SELECT GIPI_WITMPERL_PKG.is_exist_par_item_peril(#parId#, #itemNo#) FROM dual
	</select>
	
	<select id="getIssCdRi" resultClass="java.lang.String">
		SELECT param_value_v
          FROM giis_parameters
         WHERE param_name = 'ISS_CD_RI'
	</select>
	
	<procedure id="addItemPeril" parameterClass="GIPIWItemPerilClass">
		DECLARE
			witmperl			GIPI_WITMPERL%ROWTYPE;
		BEGIN
			witmperl.DISCOUNT_SW	:= #discountSw#;
			witmperl.SURCHARGE_SW	:= #surchargeSw#;
			witmperl.PRT_FLAG		:= #prtFlag#;
			witmperl.PERIL_CD		:= #perilCd#;
			witmperl.PREM_RT		:= #strPremRt#;
			witmperl.TSI_AMT		:= #strTsiAmt#;
			witmperl.PREM_AMT		:= #strPremAmt#;
			witmperl.NO_OF_DAYS		:= #noOfDays#;
			witmperl.BASE_AMT		:= #strBaseAmt#;
			witmperl.AGGREGATE_SW	:= #aggregateSw#;
			witmperl.RI_COMM_RATE	:= #strRiCommRate#;
			witmperl.RI_COMM_AMT	:= #strRiCommAmt#;
			witmperl.PAR_ID			:= #parId#;
			witmperl.ITEM_NO		:= #itemNo#;
			witmperl.LINE_CD		:= #lineCd#;
			witmperl.ANN_TSI_AMT	:= #strAnnTsiAmt#;
			witmperl.ANN_PREM_AMT	:= #strAnnPremAmt#;
			witmperl.TARF_CD		:= #tarfCd#;
			witmperl.COMP_REM		:= #compRem#;
			witmperl.REC_FLAG		:= #recFlag#;
			
			Gipi_Witmperl_Pkg.set_gipi_witmperl(witmperl);
		END;
	</procedure>
	
	<procedure id="deleteItemPeril" parameterClass="java.util.HashMap">
		BEGIN
			Gipi_Witmperl_Pkg.del_gipi_witmperl(#parId#, #itemNo#, #lineCd#, #perilCd#);
		END;
	</procedure>
	
	<procedure id="deleteItemPeril2" parameterClass="java.util.HashMap">
		BEGIN
			Gipi_Witmperl_Pkg.del_gipi_witmperl_1(#parId#, #itemNo#);
		END;
	</procedure>
	<!-- added by steven 10/23/2012 for copy peril -->
	<procedure id="delItemPerilPerItem" parameterClass="java.util.HashMap">
		BEGIN
			Gipi_Witmperl_Pkg.del_witmperl_per_item(#parId#, #itemNo#);
		END;
	</procedure>
	
	<procedure id="saveCopiedPeril" parameterClass="GIPIWItemPerilClass">
		DECLARE
			witmperl			GIPI_WITMPERL%ROWTYPE;
		BEGIN
			witmperl.DISCOUNT_SW	:= #discountSw#;
			witmperl.SURCHARGE_SW	:= #surchargeSw#;
			witmperl.PRT_FLAG		:= #prtFlag#;
			witmperl.PERIL_CD		:= #perilCd#;
			witmperl.PREM_RT		:= #strPremRt#;
			witmperl.TSI_AMT		:= #strTsiAmt#;
			witmperl.PREM_AMT		:= #strPremAmt#;
			witmperl.NO_OF_DAYS		:= #noOfDays#;
			witmperl.BASE_AMT		:= #strBaseAmt#;
			witmperl.AGGREGATE_SW	:= #aggregateSw#;
			witmperl.RI_COMM_RATE	:= #strRiCommRate#;
			witmperl.RI_COMM_AMT	:= #strRiCommAmt#;
			witmperl.PAR_ID			:= #parId#;
			witmperl.ITEM_NO		:= #itemNo#;
			witmperl.LINE_CD		:= #lineCd#;
			witmperl.ANN_TSI_AMT	:= #strAnnTsiAmt#;
			witmperl.ANN_PREM_AMT	:= #strAnnPremAmt#;
			witmperl.TARF_CD		:= #tarfCd#;
			witmperl.COMP_REM		:= #compRem#;
			witmperl.REC_FLAG		:= #recFlag#;
			
			Gipi_Witmperl_Pkg.SAVE_COPY_PERIL(witmperl);
		END;
	</procedure>
	
	<procedure id="saveCopiedPerilAmt" parameterClass="java.util.HashMap">
		BEGIN
			Gipi_Witmperl_Pkg.SAVE_COPY_PERIL_AMT(#parId#, #fromItemNo#, #itemNo#);
		END;
	</procedure>
	<!-- end steven 10/24/2012 -->
	<procedure id="isExistWItmperl" parameterMap="isExistMapWItmperl">
		{ CALL Gipi_Witmperl_Pkg.get_gipi_witmperl_exist(?, ?) }
	</procedure>
	
	<procedure id="isExistWItmperlWItemNo" resultClass="java.lang.String">
		SELECT Gipi_Witmperl_Pkg.get_gipi_witmperl_exist(#parId#, #itemNo#) FROM DUAL
	</procedure>
	
	<select id="checkDeductiblePerilItemNoIfNull" resultClass="java.lang.String">
		SELECT (GIPI_WDEDUCTIBLES_PKG.CHECK_GIPI_WDEDUCTIBLES_ITEMS(#parId#, #lineCd#, #sublineCd#)) FROM DUAL
	</select>
	
	<procedure id="deleteDiscounts" parameterMap="deleteDiscountsMap">
		{ CALL Gipi_Witmperl_Pkg.set_delete_discount( ? , ? , ? , ? )}
	</procedure>
	
	<procedure id="updateWItem" parameterClass="java.util.HashMap">
		BEGIN
			GIPI_WITMPERL_PKG.update_witem(#parId#, #itemNo#);
		END;
	</procedure>
	
		
	<procedure id="createWInvoiceForPAR" parameterClass="java.util.HashMap">
		BEGIN
			giis_users_pkg.app_user := #appUser#;
			GIPI_WITMPERL_PKG.create_winvoice_for_par(#parId#, #lineCd#, #issCd#);
		END;
	</procedure>
	
	<procedure id="insertPerilToWC" parameterClass="java.util.HashMap">
		BEGIN
			PREINSERT_GIPIS038_B490(#parId#, #lineCd#, #perilCd#);
		END;
	</procedure>
	
	<procedure id="insertPerilDefaultWC" parameterClass="java.util.HashMap">
		BEGIN
			PREINSERT_GIPIS038_B490(#parId#, #lineCd#, #perilCd#);
		END;
	</procedure>	
	
	<procedure id="deleteOtherDiscount" parameterClass="java.util.HashMap">
		BEGIN
			Gipi_Witem_Discount_Pkg.delete_other_discount(#parId#, #itemNo#);
		END;
	</procedure>

	<procedure id="deleteEndtItemPeril" parameterClass="java.util.HashMap">
		BEGIN
			Gipi_Witmperl_Pkg.del_gipi_witmperl(#parId#, #itemNo#, #lineCd#, #perilCd#);
		END;
	</procedure>

	<procedure id="insertEndtItemPeril" parameterClass="GIPIWItemPerilClass">
		DECLARE
			endtPeril			GIPI_WITMPERL%ROWTYPE;
		BEGIN
			endtPeril.PAR_ID		:= #parId#;
			endtPeril.ITEM_NO		:= #itemNo#;
			endtPeril.LINE_CD		:= #lineCd#;		
			endtPeril.PERIL_CD		:= #perilCd#;
			endtPeril.PREM_RT		:= #premRt#;
			endtPeril.TSI_AMT		:= #tsiAmt#;
			endtPeril.PREM_AMT		:= #premAmt#;
			endtPeril.ANN_TSI_AMT	:= #annTsiAmt#;
			endtPeril.ANN_PREM_AMT	:= #annPremAmt#;
			endtPeril.COMP_REM		:= #compRem#;
			endtPeril.RI_COMM_AMT	:= #riCommAmt#;
			endtPeril.RI_COMM_RATE	:= #riCommRate#;
			endtPeril.TARF_CD		:= #tarfCd#;
			endtPeril.REC_FLAG 		:= #recFlag#;
			
			Gipi_Witmperl_Pkg.set_gipi_witmperl(endtPeril);		
		END;
	</procedure>
	
	<procedure id="checkEndtPeril" parameterMap="checkEndtPerilMap">
		{ Call CHECK_ENDT_PERIL(?, ?, ?, ?, ?, ?, ?) }
	</procedure>	

	<procedure id="getEndtTariff" parameterMap="endtTariffMap">
		{ Call GET_TARIFF_ENDT_PERIL (?, ?, ?, ?, ?) }
	</procedure>	

	<procedure id="deleteEndtDiscounts">
		BEGIN
		  DELETE_ENDT_DISCOUNTS(#parId#);
		END;
	</procedure>
	
	<!-- <select id="getEndtPeril" resultMap="EndtPerilMap"> -->
	<select id="getEndtPeril" resultMap="GIPIS097GIPIWItmperlResultMap">
		SELECT * 
		  FROM TABLE(Gipi_Witmperl_Pkg.get_endt_peril(#parId#))
	</select>	

	<procedure id="includeWC" parameterClass="java.util.HashMap">
		BEGIN
			GIPI_WPOLWC_PKG.include_wc(#parId#, #lineCd#, #perilCd#);
		END;
	</procedure>	
	
	<procedure id="populateOrigItemPeril" parameterClass="java.lang.Integer">
		BEGIN
			POPULATE_ORIG_ITMPERIL3(#parId#);
		END;
	</procedure>
	
	<procedure id="createWInvoice" parameterClass="java.util.HashMap">
		BEGIN
			CREATE_WINVOICE(#policyId#, #polIdN#, #oldParId#, #parId#, #lineCd#, #issCd#);
		END;
	</procedure>
	
	<procedure id="createWInvoice1EndtItemPeril" parameterClass="java.util.HashMap">
		BEGIN
			CREATE_WINVOICE1_ENDT_ITMPERL(#parId#, #lineCd#, #issCd#);
		END;
	</procedure>
	
	<procedure id="updateParStatusEndtItemPeril">
		BEGIN
			UPDATE_PAR_STATUS_ENDT_ITMPERL(#parId#, #packParId#);
		END;
	</procedure>
	
	<select id="getNegateItemPerils" resultMap="GIPIWItemPerilMap" parameterClass="java.util.HashMap">
		SELECT * FROM TABLE(GIPI_WITMPERL_PKG.get_negate_itmperls(#parId#, #itemNo#))
	</select>
	
	<procedure id="getNegateDeletedItem" parameterMap="negateDeleteItemEndtParameterMap">
		{CALL NEGATE_DELETE_ITEM_ENDT(?, ?, ?, ?, ?, ?, ?)}
	</procedure>
	
	<select id="getMaintainedPerilListing" resultMap="GIPIWItemPerilMap" parameterClass="java.util.HashMap">
		SELECT * FROM TABLE(GIPI_WITMPERL_PKG.get_giis_plan_dtls(#parId#, #packParId#, #packLineCd#, #packSublineCd#))
	</select>
	
	<delete id="deleteAllDiscounts" parameterClass="java.lang.Integer">
		BEGIN
			GIPI_WPOLBAS_DISCOUNT_PKG.delete_all_discounts(#parId#);
		END;
	</delete>
	
	<parameterMap class="map" id="endtItemPerilPostFormsCommitParamMap">
		<parameter property="userId" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="parId" javaType="Integer" jdbcType="INTEGER" mode="IN" />
		<parameter property="userId" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="itemNo" javaType="Integer" jdbcType="INTEGER" mode="IN" />
		<parameter property="tsiAmt" javaType="Integer" jdbcType="INTEGER" mode="IN" />
		<parameter property="annTsiAmt" javaType="Integer" jdbcType="INTEGER" mode="IN" />
		<parameter property="premAmt" javaType="Integer" jdbcType="INTEGER" mode="IN" />
		<parameter property="annPremAmt" javaType="Integer" jdbcType="INTEGER" mode="IN" />
		<parameter property="varPackageSw" javaType="String" jdbcType="VARCHAR" mode="INOUT" />
		<parameter property="varDelDiscSw" javaType="String" jdbcType="VARCHAR" mode="INOUT" />
		<parameter property="varNegateItem" javaType="String" jdbcType="VARCHAR" mode="INOUT" />
	</parameterMap>
	
	<procedure id="endtItemPerilPostFormsCommit" parameterMap="endtItemPerilPostFormsCommitParamMap">
		BEGIN
		    giis_users_pkg.app_user := ?;
			gipis097_post_forms_commit(?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
		END;
	</procedure>
	
	<select id="checkPerilExist" parameterClass="java.lang.Integer" resultClass="java.lang.Integer">
		SELECT gipi_witmperl_pkg.check_peril_exist(#parId#) FROM DUAL
	</select>
	
	<procedure id="gipis065InsertRecGrpWItem" parameterMap="negateDeleteItemEndtParameterMap">
		{CALL GIPIS065_INSERT_RECGRP_WITEM(?, ?, ?, ?, ?, ?, ?)}
	</procedure>
	
	<parameterMap class="map" id="checkItemPerilExistMapGIPIS065">
		<parameter property="itemNo" javaType="Integer" jdbcType="INTEGER" mode="IN" />
		<parameter property="lineCd" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="sublineCd" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="issCd" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="issueYy" javaType="Integer" jdbcType="INTEGER" mode="IN" />
		<parameter property="polSeqNo" javaType="Integer" jdbcType="INTEGER" mode="IN" />
		<parameter property="renewNo" javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="effDate" javaType="Date" jdbcType="java.util.Date" mode="IN" />
	</parameterMap>
	
	<select id="checkItemPerilExistsGIPIS065" parameterMap="checkItemPerilExistMapGIPIS065" resultClass="String">
		SELECT CHECK_ITMPERL_EXISTS(
				?, ?, ?, ?, ?, ?, ?, ?
		) FROM DUAL
	</select>
	
	<select id="getGIPIWItemPerilTableGrid" parameterClass="java.util.HashMap" resultMap="ItemPerilTableGridResultMap">
		SELECT *
		  FROM (SELECT rownum rownum_,
					   b.count_,
					   a.*
				  FROM (SELECT *
						  FROM TABLE(gipi_witmperl_pkg.get_gipi_witmperl_tg(#parId#, #itemNo#, #perilName#, #compRem#))
						  <isNull property="sortColumn">
								ORDER BY peril_name ASC
						  </isNull>
						  <isNotNull property="sortColumn">
								<isEqual property="sortColumn" compareValue="perilName">
									ORDER BY peril_name
								</isEqual>
								<isEqual property="sortColumn" compareValue="premRt">
									ORDER BY prem_rt
								</isEqual>
								<isEqual property="sortColumn" compareValue="tsiAmt">
									ORDER BY tsi_amt
								</isEqual>
								<isEqual property="sortColumn" compareValue="premAmt">
									ORDER BY prem_amt
								</isEqual>
								<isEqual property="sortColumn" compareValue="compRem">
									ORDER BY comp_rem
								</isEqual>
								<isEqual property="ascDescFlg" compareValue="ASC">
									ASC
								</isEqual>
								<isEqual property="ascDescFlg" compareValue="DESC">
									DESC
								</isEqual>
						  </isNotNull>) a,
						  (SELECT COUNT(*) count_
							 FROM TABLE(gipi_witmperl_pkg.get_gipi_witmperl_tg(#parId#, #itemNo#, #perilName#, #compRem#))) b)
		 WHERE rownum_ BETWEEN #from# AND #to#
	</select>
	
	<procedure id="computeTsi" parameterMap="computeTsiMap">
		BEGIN
			gipis097_compute_tsi(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
		END;
	</procedure>
	
	<select id="getGIPIWItmperlCount" resultClass="Integer">
		SELECT COUNT(*) FROM gipi_witmperl WHERE par_id = #parId#
	</select>
	
	<select id="getEndtGIPIWItemPerilTableGrid" parameterClass="java.util.HashMap" resultMap="ItemPerilTableGridResultMap">
		SELECT *
		  FROM (SELECT rownum rownum_,
					   b.count_,
					   a.*
				  FROM (SELECT *
						  FROM TABLE(gipi_witmperl_pkg.get_gipi_witmperl_tg(#parId#, #itemNo#, #perilName#, #compRem#))
						  <isNull property="sortColumn">
								ORDER BY peril_name ASC
						  </isNull>
						  <isNotNull property="sortColumn">
								<isEqual property="sortColumn" compareValue="perilName">
									ORDER BY peril_name
								</isEqual>
								<isEqual property="sortColumn" compareValue="premRt">
									ORDER BY prem_rt
								</isEqual>
								<isEqual property="sortColumn" compareValue="tsiAmt">
									ORDER BY tsi_amt
								</isEqual>
								<isEqual property="sortColumn" compareValue="premAmt">
									ORDER BY prem_amt
								</isEqual>
								<isEqual property="sortColumn" compareValue="compRem">
									ORDER BY comp_rem
								</isEqual>
								<isEqual property="ascDescFlg" compareValue="ASC">
									ASC
								</isEqual>
								<isEqual property="ascDescFlg" compareValue="DESC">
									DESC
								</isEqual>
						  </isNotNull>) a,
						  (SELECT COUNT(*) count_
							 FROM TABLE(gipi_witmperl_pkg.get_gipi_witmperl_tg(#parId#, #itemNo#, #perilName#, #compRem#))) b)
		 WHERE rownum_ BETWEEN #from# AND #to#
	</select>
	
	<procedure id="updateChangeInAssd" parameterClass="java.util.HashMap">
		BEGIN
			gipi_witmperl_pkg.update_change_in_assured(#parId#, #lineCd#, #issCd#);
		END;
	</procedure>
	
	<resultMap class="java.util.HashMap" id="noPerilItemsMap">
		<result column="PAR_ID" 		property="parId"/>
		<result column="ITEM_NO" 		property="itemNo"/>
	</resultMap>
	
	<select id="getItemsWithNoPerils" parameterClass="map" resultMap="noPerilItemsMap">
		SELECT * FROM TABLE(GIPI_WITMPERL_PKG.get_items_without_perils(#parId#, #packParId#)) 
	</select>
	
	<select id="getItemPerilDefaultTag" parameterClass="map" resultClass="String">
		SELECT GIPI_WITMPERL_PKG.get_peril_default_tag(#lineCd#, #nbtSublineCd#) FROM DUAL
	</select>
	
	<procedure id="validatePremiumAmount" parameterMap="validatePremiumAmountMap">
		BEGIN
			VALIDATE_PREMIUM_AMOUNT_2(?, ?, ?, ?, ?);
		END;
	</procedure>

	<parameterMap class="java.util.HashMap" id="GIPIS097RetrievePerilsParamMap">
		<parameter property="userId" 	javaType="String" jdbcType="VARCHAR" mode="IN" />
		<parameter property="parId" 	javaType="String" jdbcType="NUMBER" mode="IN"/>
		<parameter property="itemNo" 	javaType="String" jdbcType="NUMBER" mode="IN"/>
   		<parameter property="tsiAmt" 	javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="annTsiAmt" javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="premAmt" 	javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="annPremAmt" javaType="String" jdbcType="NUMERIC" mode="OUT"/>
	</parameterMap>

	<procedure id="retrievePerils" parameterMap="GIPIS097RetrievePerilsParamMap">
		BEGIN
		   giis_users_pkg.app_user := ?;
		   gipis097_retrieve_perils(?, ?, ?, ?, ?, ?);
		END; 
	</procedure>
	
	<parameterMap class="java.util.HashMap" id="GIPIS097WhenValPerilParamMap">
		<parameter property="parId" 	javaType="String" jdbcType="NUMBER" mode="IN"/>
		<parameter property="itemNo" 	javaType="String" jdbcType="NUMBER" mode="IN"/>
		<parameter property="perilCd" 	javaType="String" jdbcType="NUMBER" mode="IN"/>
		<parameter property="perilType" javaType="String" jdbcType="VARCHAR" mode="IN"/>
		<parameter property="recFlag" 	javaType="String" jdbcType="VARCHAR" mode="OUT"/>
		<parameter property="premRt" 	javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="tsiAmt" 	javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="annTsiAmt" javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="premAmt" 	javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="annPremAmt" javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="baseAnnPremAmt" javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="riCommRate" javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="riCommAmt" javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="baseAmt" 	javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="noOfDays" 	javaType="String" jdbcType="NUMERIC" mode="OUT"/>
   		<parameter property="aggregateSw" javaType="String" jdbcType="VARCHAR" mode="OUT"/>
	</parameterMap>
	
	<procedure id="gipis097WhenValPeril" parameterMap="GIPIS097WhenValPerilParamMap">
		BEGIN
			gipis097_when_val_peril(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
		END;
	</procedure>
	
    <parameterMap class="map" id="GIPIS097ComputePremParamMap">
		<parameter property="parId" 			jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemNo" 		 	jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="perilCd" 		 	jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="premAmt"	 		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="tsiAmt"	 		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>		
		<parameter property="annPremAmt"	 	jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="annTsiAmt"	 		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemPremAmt"		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemAnnPremAmt"	jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="changedTag" 		jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemToDate"		jdbcType="VARCHAR"		javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemFromDate"		jdbcType="VARCHAR"		javaType="java.lang.String"	mode="IN"/>
		<parameter property="shortRtPercent"	jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="prorateFlag"		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="riCommRate"		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<!-- <parameter property="premRate"			jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/> -->
		<parameter property="riCommAmt"			jdbcType="NUMERIC"	javaType="java.math.BigDecimal"	mode="OUT"/>
		<parameter property="outAnnPremAmt" 	jdbcType="NUMERIC"	javaType="java.math.BigDecimal"	mode="OUT"/>
		<parameter property="baseAnnPremAmt" jdbcType="NUMERIC"	javaType="java.math.BigDecimal"	mode="OUT"/>
		<parameter property="outPremRt"	 		jdbcType="NUMERIC"	javaType="java.math.BigDecimal"	mode="OUT"/>	
		<parameter property="itemPremAmt" 		jdbcType="NUMERIC"	javaType="java.math.BigDecimal"	mode="OUT"/>
		<parameter property="itemAnnPremAmt" 	jdbcType="NUMERIC"	javaType="java.math.BigDecimal"	mode="OUT"/>
	</parameterMap>	
	
	<procedure id="gipis097ComputePremium" parameterMap="GIPIS097ComputePremParamMap">
		BEGIN
			gipis097_compute_premium(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
		END;
	</procedure>
	
	<parameterMap class="java.util.HashMap" id="GIPIS097ComputePremiumRateParamMap">
		<parameter property="parId" 		 		jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemNo" 		 		jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="perilCd" 		 		jdbcType="NUMBER"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="premRt"	 			jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="tsiAmt"	 			jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="recFlag"	 			jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="coverageCd" 			jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="tariffZone" 			jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="sublineTypeCd"			jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="motType"	 			jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="constructionCd"		jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="tarfCd"	 			jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="changedTag" 		 	jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>		
		<parameter property="annTsiAmt"	 			jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="annPremAmt"	 		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemTsiAmt"			jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemAnnTsiAmt"			jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>				
		<parameter property="itemPremAmt"			jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemAnnPremAmt"		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>		
		<parameter property="noOfDays" 		 		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemToDate"			jdbcType="VARCHAR"		javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemFromDate"			jdbcType="VARCHAR"		javaType="java.lang.String"	mode="IN"/>
		<parameter property="itemCompSw"			jdbcType="VARCHAR"	javaType="java.lang.String"	mode="IN"/>
		<parameter property="outPremAmt" 		 	jdbcType="NUMERIC"	javaType="java.lang.String"	mode="OUT"/>
		<parameter property="outAnnPremAmt" 		jdbcType="NUMERIC"	javaType="java.lang.String"	mode="OUT"/>
		<parameter property="baseAnnPremAmt" 	jdbcType="NUMERIC"	javaType="java.lang.String"	mode="OUT"/>		
	</parameterMap>	
	
	<procedure id="gipis097ComputePremiumRate" parameterMap="GIPIS097ComputePremiumRateParamMap">
	    BEGIN
			gipis097_when_val_prem_rt(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
		END;
	</procedure>
	
	<resultMap class="GIPIWItemPerilClass" id="itemPerilLOV">
		<result column="item_no"	    	    property="itemNo" />
		<result column="peril_cd"			    property="perilCd"/>
		<result column="peril_name" 			property="perilName"/>
		<result column="peril_type" 			property="perilType"/>
		<result column="tsi_amt" 				property="tsiAmt"/>
		<result column="prem_amt" 				property="premAmt"/>
		<result property="rowNum"			    column="ROWNUM_"/>
		<result property="rowCount"			    column="COUNT_"/>
	</resultMap>
	
	<!-- changed query by robert 11.14.2013 -->
	<select id="getBillItemPerilLOV"	resultMap="itemPerilLOV">  	
  		SELECT *
		  FROM (SELECT rownum rownum_, 
		               b.count_, 
		               a.* 
		          FROM (SELECT * FROM TABLE(GIPI_WITMPERL_PKG.get_witmperl_list4(#parId#,#lineCd#,#itemNo#)) 
		          		 <isNotNull property="findText">
				         WHERE (UPPER(peril_name) LIKE UPPER(#findText#) 
				         	 OR UPPER(peril_cd) LIKE UPPER(#findText#)
				         	 )
				         </isNotNull>
		          		  <isEqual property="sortColumn" compareValue="perilName">
			              		ORDER BY peril_name
			              </isEqual>
			              <isEqual property="sortColumn" compareValue="perilCd">
			              		ORDER BY peril_cd
			              </isEqual> 
			          	  <isNotNull property="sortColumn">
			              		<isEqual property="ascDescFlg" compareValue="ASC">
			              			ASC
			              		</isEqual>
			              		<isEqual property="ascDescFlg" compareValue="DESC">
			              			DESC
			              		</isEqual>
			              </isNotNull>
		                  ) a, 
		               (SELECT count(*) count_ 
		                  FROM TABLE (GIPI_WITMPERL_PKG.get_witmperl_list4(#parId#,#lineCd#,#itemNo#))
		                 <isNotNull property="findText">
				         WHERE (UPPER(peril_name) LIKE UPPER(#findText#) 
				         	 OR UPPER(peril_cd) LIKE UPPER(#findText#)
				         	 )
				         </isNotNull>
		                  ) b) 
		 WHERE rownum_ BETWEEN #from# AND #to#
  	</select>
	
	<procedure id="validateBackAllied">
		BEGIN
			gipis097_validate_back_allied(#parId#, #itemNo#, #perilCd#, #perilType#, #bascPerlCd#, #tsiAmt#, #premAmt#, #existingPerils#);
		END;
	</procedure>	

	<procedure id="deleteWitemPerilTariff" parameterClass="java.util.HashMap">
		BEGIN
			giis_users_pkg.app_user := #appUser#;
			giis_peril_pkg.del_gipi_witmperl_tariff(#parId#, #itemNo#, #lineCd#, #sublineCd#);
		END;
	</procedure>
	
	<procedure id="updateWithTariffSw" parameterClass="java.util.HashMap">
		BEGIN
			giis_users_pkg.app_user := #userId#;
			UPDATE gipi_wpolbas
	 		   SET with_tariff_sw = #withTariffSw#
	 		WHERE par_id = #parId#;
		END;
	</procedure>
</sqlMap>